<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Andika AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;600&display=swap" rel="stylesheet">
    
    <script src="js/main.js"></script>

    <script>
        tailwind.config = {
            theme: { extend: { colors: { neon: '#00ff9c', darkbg: '#050505' }, fontFamily: { orbitron: ['Orbitron'], inter: ['Inter'] } } }
        }
    </script>

    <style>
        body { background: #050505; color: white; font-family: 'Inter', sans-serif; }
        
        /* CARD STYLE & OVERLAY FIX */
        .card { 
            background: rgba(20, 20, 20, 0.6); 
            border: 1px solid #333; 
            backdrop-filter: blur(10px); 
            transition: 0.3s;
            position: relative; /* Wajib biar loading nempel di card */
            overflow: hidden;   /* Wajib biar loading gak bocor */
        }
        .card:hover { border-color: #00ff9c; box-shadow: 0 0 15px rgba(0, 255, 156, 0.1); }
        
        .input-box { width: 100%; background: #111; border: 1px solid #444; color: white; padding: 12px; outline: none; border-radius: 4px; }
        .input-box:focus { border-color: #00ff9c; }

        /* --- LOADING OVERLAY KEREN --- */
        .loading-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 50;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .is-loading { opacity: 1; pointer-events: auto; }

        .cyber-spinner {
            width: 50px; height: 50px;
            border: 3px solid rgba(0, 255, 156, 0.1);
            border-top: 3px solid #00ff9c;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            box-shadow: 0 0 20px rgba(0, 255, 156, 0.4);
        }

        .loading-text {
            margin-top: 15px; font-family: 'Orbitron', sans-serif;
            color: #00ff9c; font-size: 0.8rem; letter-spacing: 1px;
            animation: blink 1.5s infinite; text-align: center;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <nav class="p-4 border-b border-gray-800 bg-black sticky top-0 z-50 flex justify-between items-center">
        <div class="font-orbitron font-bold text-neon text-xl">ANDIKA AI <span class="text-xs text-white px-2 py-0.5 border border-white rounded ml-2">PRO</span></div>
        <div class="flex gap-4 text-sm items-center">
            <span id="welcomeUser" class="hidden md:inline text-gray-400">User</span>
            <a href="profile.html" class="hover:text-neon">Profile</a>
            <button onclick="logout()" class="text-red-500 hover:text-red-400">Logout</button>
        </div>
    </nav>

    <div class="container mx-auto p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">

        <div class="card p-6 rounded-xl">
            <h3 class="font-orbitron text-neon text-xl mb-2">ðŸŽ¨ Real Image Gen</h3>
            <p class="text-xs text-gray-400 mb-4">Stable Diffusion Engine</p>
            
            <input type="text" id="imgPrompt" placeholder="Contoh: hacker cat in neon city..." class="input-box mb-3">
            <button onclick="runImageGen()" class="w-full bg-neon text-black font-bold py-3 rounded hover:bg-white transition">GENERATE GAMBAR</button>
            
            <canvas id="resultCanvas" class="w-full mt-4 bg-black border border-gray-800 hidden"></canvas>
            <button id="dlBtn" onclick="downloadImage()" class="w-full border border-neon text-neon mt-2 py-2 rounded hidden hover:bg-neon hover:text-black">DOWNLOAD</button>

            <div id="loaderImage" class="loading-overlay">
                <div class="cyber-spinner"></div>
                <p class="loading-text">RENDERING IMAGE...<br>TUNGGU SEBENTAR</p>
            </div>
        </div>

        <div class="card p-6 rounded-xl">
            <h3 class="font-orbitron text-neon text-xl mb-2">ðŸ’» AI Coding Expert</h3>
            <p class="text-xs text-gray-400 mb-4">Powered by GPT Model</p>
            
            <select id="codeLang" class="input-box mb-3">
                <option value="HTML & CSS">HTML & Tailwind</option>
                <option value="JavaScript">JavaScript</option>
                <option value="Python">Python</option>
                <option value="PHP">PHP</option>
            </select>
            <textarea id="codePrompt" rows="2" placeholder="Mau buat program apa?" class="input-box mb-3"></textarea>
            <button onclick="runCodeGen()" class="w-full bg-neon text-black font-bold py-3 rounded hover:bg-white transition">BUAT KODE</button>
            
            <textarea id="codeResult" rows="6" class="input-box mt-4 font-mono text-xs text-neon hidden" readonly></textarea>

            <div id="loaderCode" class="loading-overlay">
                <div class="cyber-spinner"></div>
                <p class="loading-text">MENULIS KODE...<br>MOHON SABAR</p>
            </div>
        </div>

        <div class="card p-6 rounded-xl">
            <h3 class="font-orbitron text-neon text-xl mb-2">ðŸŽ“ Guru AI Pintar</h3>
            <p class="text-xs text-gray-400 mb-4">Jawaban Akurat & Penjelasan</p>
            
            <textarea id="soalInput" rows="3" placeholder="Tulis soal pelajaran di sini..." class="input-box mb-3"></textarea>
            <button onclick="runSchool()" class="w-full bg-neon text-black font-bold py-3 rounded hover:bg-white transition">JAWAB SOAL</button>
            
            <div id="schoolResult" class="mt-4 p-3 bg-gray-900 border border-gray-700 text-sm hidden rounded h-40 overflow-y-auto"></div>

            <div id="loaderSchool" class="loading-overlay">
                <div class="cyber-spinner"></div>
                <p class="loading-text">MENCARI JAWABAN...<br>SEDANG BERPIKIR</p>
            </div>
        </div>

        <div class="card p-6 rounded-xl">
            <h3 class="font-orbitron text-neon text-xl mb-2">ðŸŽ¤ Text to Voice</h3>
            <p class="text-xs text-gray-400 mb-4">Browser Native TTS</p>
            
            <textarea id="voiceText" rows="3" placeholder="Masukkan teks..." class="input-box mb-3"></textarea>
            <button onclick="runVoice()" class="w-full bg-neon text-black font-bold py-3 rounded hover:bg-white transition">BICARA</button>
        </div>

    </div>

    <script>
        // 1. Cek Login (LocalStorage)
        const user = checkAuth(); // Fungsi dari main.js
        if(user) {
            document.getElementById('welcomeUser').innerText = "Hi, " + user.username;
        }

        // 2. Logic Image Gen
        async function runImageGen() {
            const prompt = document.getElementById('imgPrompt').value;
            if(!prompt) return alert("Isi prompt dulu!");
            
            const loader = document.getElementById('loaderImage');
            const canvas = document.getElementById('resultCanvas');
            const btn = document.getElementById('dlBtn');

            loader.classList.add('is-loading'); // Show Loading
            canvas.style.display = 'none';
            btn.style.display = 'none';

            try {
                // Panggil fungsi AI dari main.js
                const imgObj = await generateRealImage(prompt);
                
                canvas.style.display = 'block';
                btn.style.display = 'block';
                addWatermarkToCanvas(canvas, imgObj); // Watermark logic di main.js
            } catch (err) {
                alert("Gagal: " + err);
            } finally {
                loader.classList.remove('is-loading'); // Hide Loading
            }
        }

        function downloadImage() {
            const link = document.createElement('a');
            link.download = 'andika-ai-result.png';
            link.href = document.getElementById('resultCanvas').toDataURL();
            link.click();
        }

        // 3. Logic Code Gen
        async function runCodeGen() {
            const lang = document.getElementById('codeLang').value;
            const prompt = document.getElementById('codePrompt').value;
            if(!prompt) return alert("Deskripsikan kodenya!");

            const loader = document.getElementById('loaderCode');
            const output = document.getElementById('codeResult');
            
            loader.classList.add('is-loading');
            output.style.display = 'none';

            const system = `Anda adalah Programmer Expert bahasa ${lang}. Berikan HANYA kode.`;
            
            try {
                const result = await generateRealText(prompt, system);
                output.value = result;
                output.style.display = 'block';
            } catch (e) {
                alert("AI Error");
            } finally {
                loader.classList.remove('is-loading');
            }
        }

        // 4. Logic School Helper
        async function runSchool() {
            const soal = document.getElementById('soalInput').value;
            if(!soal) return alert("Mana soalnya?");

            const loader = document.getElementById('loaderSchool');
            const output = document.getElementById('schoolResult');

            loader.classList.add('is-loading');
            output.style.display = 'none';

            const system = "Jawab pertanyaan siswa dengan jelas, singkat, dan tepat. Bahasa Indonesia.";
            
            try {
                const result = await generateRealText(soal, system);
                output.innerHTML = result.replace(/\n/g, '<br>');
                output.style.display = 'block';
            } catch (e) {
                alert("AI Error");
            } finally {
                loader.classList.remove('is-loading');
            }
        }

        // 5. Logic Voice
        function runVoice() {
            const text = document.getElementById('voiceText').value;
            if(!text) return;
            
            window.speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'id-ID';
            utterance.rate = 1;
            
            // Watermark Audio
            utterance.onend = () => {
                const wm = new SpeechSynthesisUtterance("Andika AI Platform");
                wm.lang = 'id-ID';
                window.speechSynthesis.speak(wm);
            };

            window.speechSynthesis.speak(utterance);
        }
    </script>
</body>
</html>
